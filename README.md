# PA3. Знакомство с NATS. Асинхронная обработка, конкурирующие потребители

**Цель:** научиться использовать брокер сообщений для организации асинхронного вычисления и масштабирования РС.

## Задание

*Задание делается на базе задания PA2.*

Необходимо вынести вычисление оценки текста из веб-приложения и запустить в отдельном процессе - *RankCalculator*.
Экземпляр процесса RankCalculator подключается в качестве потребителя к брокеру сообщений NATS и начинает выполнять задания, отправляемые в его очередь в виде сообщений. 
Значение вычисленнго ранга должно сохраняться в БД Redis, как и прежде.

Папка *nats_example* содержит пример процессов, взаимодействующих с помощью NATS.

Необходимо обеспечить возможность запуска нескольких процессов RankCalculator так, чтобы сообщения распределялись между экземплярами процессов, т.е. чтобы процессы работали в режиме конкурирующих потребителей.

Необходимо добавить запуск/останов экземпляров *RankCalculator* в скрипты start/stop.

#### Изменения в веб-приложении
Обработчик страницы *index* теперь не должен вычислять значение rank. Вместо этого должно создаваться задание для процесса *RankCalculator* и отправляться через брокер сообщений NATS. Остальная логика остаётся без изменений - пользователю возвращается код *302 Redirect* на страницу *summary*.

#### Какую информацию передавать в сообщениях?
Хорошим подходом считается сохранять большие данные в хранилище сразу после получения от пользователя, а в сообщениях передавать ссылку, по которой можно получить данные при необходимости. Но есть брокеры сообщений, которые спроектированы специально для передачи больших объёмов данных внутри сообщения (например Apache Kafka).

### Ссылки:
1. NATS, https://nats.io/
2. Библиотека для работы с NATS: https://www.nuget.org/packages/NATS.Client
3. Описание шаблона "Конкурирующие потребители" https://docs.microsoft.com/en-us/azure/architecture/patterns/competing-consumers

