# PA2. Знакомство с Nginx

**Цель**: научиться масштабировать веб-приложение с помощью сервера Nginx

## Задание

*Работа делается на основе задания PA1.*

**Масштабируемость** - способность распределённой системы эффективно справляться с ростом числа пользователей и/или числа обслуживаемых ресурсов без увеличения административной нагрузки на её обслуживание.

В данной работе мы реализуем относительно простой и быстро осуществимый способ масштабирования - добавление новых экземпляров приложения. Такой способ масштабирования называется горизонтальным.

В реальных условиях экземпляры веб-приложения обычно запускаются на разных физических машинах. Нам будет достаточно запускать все экземпляры на одном компьютере в виде отдельных процессов.
Запуская процессы на одном компьютере необходимо следить, чтобы каждому процессу был назначен свободный порт. Процесс не запустится, если назначенный ему порт уже занят другим процессом.

### Порядок выполнения

Для начала запустите два процесса веб-приложения *Valuator* на портах 5001 и 5002.
Для запуска ASP.Net Core приложения с указанием порта можно воспользоваться параметром *--urls*, *0.0.0.0* означает слушать порт на всех сетевых интерфейсах:

``` 
	dotnet run --urls "http://0.0.0.0:5001"
```

После запуска проверьте работоспособность каждого экземпляра приложения, обратившись напрямую по номеру его порта, например  http://localhost:5001

Пользователь будет обращаться к приложению через сервер-посредник, который должен иметь постоянный (известный пользователю) адрес, а посредник будет ретранслировать пользовательские запросы на запущенные экземпляры приложения.

Такой сервер-посредник называется прокси-сервером. В качестве прокси-сервера мы будем использовать сервер Nginx. *Nginx* - популярный HTTP-сервер с функцией обратного прокси-сервера и балансировщика нагрузки.
Мы будем использовать Nginx в качестве прокси-сервера и балансировщика нагрузки.

Базовая версия Nginx доступна по адресу 
http://nginx.org/ru/

В рамках задания необходимо:

#### 1. Настроить Nginx в качестве прокси-сервера
На основании прилагаемого файла конфигурации *nginx/conf/nginx.conf* необходимо настроить прокси-сервер на Nginx.
Пользователь должен обращаться к приложению по адресу http://localhost:8080/, на котором запущен nginx-сервер, и все пользовательские запросы должны проксироваться для обработки к процессам, запущенным на портах 5001 и 5002.

После успешной настройки прокси-сервера попробуйте провести эксперименты с остановом (отказом) экземпляров веб-приложения и добавлением новых экземпляров на других портах (5003, 5004 и т.д.).

Поэкспериментируйте с разными методами балансировки нагрузки. Описание методов можно найти здесь:
http://nginx.org/en/docs/http/load_balancing.html#nginx_load_balancing_methods

#### 2. Автоматизировать запуск/останов системы

С увеличением числа компонентов возрастает риск человеческой ошибки при её обслуживании. Уменьшить человеческий фактор помогают скрипты, которые автоматизируют рутинные процессы.
В рамках данного задания необходимо автоматизировать этапы запуска и останова компонентов нашего приложения.

Необходимо разработать и разместить в директории *scripts* следующие файлы:

1. *start.(cmd|ps1|sh)* - скрипт запуска компонентов (процессов веб-приложения и прокси-сервера Nginx);
2. *stop.(cmd|ps1|sh)* - скрипт останова компонентов (процессов веб-приложения и прокси-сервера Nginx).

*Замечание: размещать бинарные файлы nginx в репозитории не нужно. Для автоматической проверки задания из репозитория будет взят только файл nginx.conf.*

## Ссылки
1. Nginx, https://www.nginx.com/
